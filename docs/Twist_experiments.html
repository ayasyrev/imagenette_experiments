---

title: Twist experiments

keywords: fastai
sidebar: home_sidebar

summary: "Experiments with Twist layer."
description: "Experiments with Twist layer."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: Twist_experiments.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://colab.research.google.com/github/ayasyrev/imagenette_experiments/blob/master/Twist_experiments.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="setup-and-imports">setup and imports<a class="anchor-link" href="#setup-and-imports"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">imagenette_experiments.train_utils</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.basic_train</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastai.vision</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">model_constructor.net</span> <span class="kn">import</span> <span class="n">Net</span><span class="p">,</span> <span class="n">act_fn</span>
<span class="kn">from</span> <span class="nn">model_constructor.layers</span> <span class="kn">import</span> <span class="n">SimpleSelfAttention</span><span class="p">,</span> <span class="n">ConvLayer</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Twist">Twist<a class="anchor-link" href="#Twist"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">model_constructor.twist</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we got Twist module, Twist layer and Twist Block.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ConvTwist</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>model_constructor.twist.ConvTwist</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ConvLayerTwist</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>model_constructor.twist.ConvLayerTwist</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ConvLayerTwist - same as base ConvLayer, bun Conv2D now Twist module.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ConvLayerTwist</span><span class="o">.</span><span class="n">Conv2d</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>model_constructor.twist.ConvTwist</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now i use NewResBlockTwist, but later i'll uniform it - will be regular ResBlock with plugable Twist (or whatever).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">NewResBlockTwist</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>model_constructor.twist.NewResBlockTwist</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Model-Constructor">Model Constructor<a class="anchor-link" href="#Model-Constructor"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Net</span><span class="p">(</span><span class="n">c_out</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">expansion</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">NewResBlockTwist</span>
<span class="n">model</span><span class="o">.</span><span class="n">stem_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">]</span>
<span class="n">model</span><span class="o">.</span><span class="n">act_fn</span> <span class="o">=</span> <span class="n">Mish</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">sa</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model">Model<a class="anchor-link" href="#Model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Most interesting - body part.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">l_1</span><span class="o">.</span><span class="n">bl_0</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>NewResBlockTwist(
  (reduce): AvgPool2d(kernel_size=2, stride=2, padding=0)
  (convs): Sequential(
    (conv_0): ConvLayer(
      (conv): Conv2d(256, 128, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (bn): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (act_fn): Mish()
    )
    (conv_1_twist): ConvLayerTwist(
      (conv): ConvTwist(
        twist: False, permute: True, same: True, groups: 16
        (conv): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), groups=16, bias=False)
      )
      (bn): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (act_fn): Mish()
    )
    (conv_2): ConvLayer(
      (conv): Conv2d(128, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (bn): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    )
  )
  (idconv): ConvLayer(
    (conv): Conv2d(256, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)
    (bn): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  )
  (merge): Mish()
)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="learner-anf-lr_find">learner anf lr_find<a class="anchor-link" href="#learner-anf-lr_find"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">get_learn</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">mixup</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>data path   /notebooks/data/imagewoof2
Learn path /notebooks/data/imagewoof2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">lr_find</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='0' class='' max='1', style='width:300px; height:20px; vertical-align: middle;'></progress>
      0.00% [0/1 00:00<00:00]
    </div>
    
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>top_k_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table><p>

    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='92' class='' max='282', style='width:300px; height:20px; vertical-align: middle;'></progress>
      32.62% [92/282 00:24<00:50 8.7527]
    </div>
    
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>set state called
LR Finder is complete, type {learner_name}.recorder.plot() to see the graph.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">recorder</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Experiments">Experiments<a class="anchor-link" href="#Experiments"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now if we wont to experiment, we can just plug new version to model.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NewTwist</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;New twist, as example, self.twist is True...&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> 
                 <span class="n">ks</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                 <span class="n">groups</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">init_max</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">twist</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">permute</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twist</span> <span class="o">=</span> <span class="n">twist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">permute</span> <span class="o">=</span> <span class="n">permute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">same</span> <span class="o">=</span> <span class="n">ni</span><span class="o">==</span><span class="n">nf</span> <span class="ow">and</span> <span class="n">stride</span><span class="o">==</span><span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ni</span><span class="o">%</span><span class="k">groups</span>==0 and nf%groups==0): groups = 1
        <span class="k">elif</span> <span class="n">ni</span><span class="o">%</span><span class="k">64</span>==0: groups = ni//8
        
        <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">twist</span><span class="p">:</span>
            <span class="n">std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coeff_Ax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">ni</span><span class="o">//</span><span class="n">groups</span><span class="p">))</span><span class="o">.</span><span class="n">normal_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">std</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coeff_Ay</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">ni</span><span class="o">//</span><span class="n">groups</span><span class="p">))</span><span class="o">.</span><span class="n">normal_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">std</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iters</span> <span class="o">=</span> <span class="n">iters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">stride</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivatives</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">derivatives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">D_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
        <span class="n">D_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
        <span class="k">def</span> <span class="nf">convolution</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">D_xx</span> <span class="o">=</span> <span class="n">convolution</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="n">D_x</span><span class="p">,</span> <span class="n">I</span><span class="o">+</span><span class="n">D_x</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">D_yy</span> <span class="o">=</span> <span class="n">convolution</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="n">D_y</span><span class="p">,</span> <span class="n">I</span><span class="o">+</span><span class="n">D_y</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">D_xy</span> <span class="o">=</span> <span class="n">convolution</span><span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="n">D_x</span><span class="p">,</span> <span class="n">I</span><span class="o">+</span><span class="n">D_y</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">D_x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">D_y</span><span class="p">,</span> <span class="s1">&#39;xx&#39;</span><span class="p">:</span> <span class="n">D_xx</span><span class="p">,</span> <span class="s1">&#39;yy&#39;</span><span class="p">:</span> <span class="n">D_yy</span><span class="p">,</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span> <span class="n">D_xy</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeff_x</span><span class="p">,</span> <span class="n">coeff_y</span><span class="p">):</span>
        <span class="n">D_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">coeff_x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">D_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">coeff_x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coeff_x</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">D_x</span> <span class="o">+</span> <span class="n">coeff_y</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">D_y</span>

    <span class="k">def</span> <span class="nf">full_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel</span><span class="p">):</span> <span class="c1"># permuting the groups</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">kernel</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">//</span><span class="n">n</span>
        <span class="n">KK</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">a</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="n">b</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="c1"># KK[:a,-b:] = kernel[:a]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="k">4</span>==0:
                <span class="n">KK</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">):</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)]</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">KK</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span><span class="n">b</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">KK</span>

    <span class="k">def</span> <span class="nf">_conv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inpt</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">permute</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">kernel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">weight</span>
        <span class="k">if</span> <span class="n">permute</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">inpt</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stride</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">inpt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_kernel</span><span class="p">(</span><span class="n">kernel</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stride</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">symmetrize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conv_wt</span><span class="p">):</span>
        <span class="c1"># conv_wt.data = (conv_wt - conv_wt.flip(2).flip(3)) / 2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">same</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">conv_wt</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">):</span>
                <span class="n">conv_wt</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">conv_wt</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">conv_wt</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inpt</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conv</span><span class="p">(</span><span class="n">inpt</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">twist</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">w</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="n">XX</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">w</span><span class="p">))[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> 
        <span class="n">YY</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">w</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="n">h</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        
        <span class="n">kernel_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coeff_Ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff_Ay</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetrize</span><span class="p">(</span><span class="n">kernel_x</span><span class="p">)</span>
        <span class="n">kernel_y</span> <span class="o">=</span> <span class="n">kernel_x</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># make conv_y a 90 degree rotation of conv_x</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">XX</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conv</span><span class="p">(</span><span class="n">inpt</span><span class="p">,</span> <span class="n">kernel_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">YY</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conv</span><span class="p">(</span><span class="n">inpt</span><span class="p">,</span> <span class="n">kernel_y</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">same</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">iters</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">inpt</span> <span class="o">+</span> <span class="n">out</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">iters</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iters</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conv</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">+</span> <span class="n">XX</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conv</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">kernel_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">YY</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conv</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">kernel_y</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">iters</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">-</span> <span class="n">inpt</span>
        <span class="k">return</span> <span class="n">out</span>
      
    <span class="k">def</span> <span class="nf">extra_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;twist: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">twist</span><span class="si">}</span><span class="s2">, permute: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">permute</span><span class="si">}</span><span class="s2">, same: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">same</span><span class="si">}</span><span class="s2">, groups: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ConvLayerTwist</span><span class="o">.</span><span class="n">Conv2d</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>model_constructor.twist.ConvTwist</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ConvLayerTwist</span><span class="o">.</span><span class="n">Conv2d</span> <span class="o">=</span> <span class="n">NewTwist</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ConvLayerTwist</span><span class="o">.</span><span class="n">Conv2d</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>__main__.NewTwist</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lets check!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">l_1</span><span class="o">.</span><span class="n">bl_0</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>NewResBlockTwist(
  (reduce): AvgPool2d(kernel_size=2, stride=2, padding=0)
  (convs): Sequential(
    (conv_0): ConvLayer(
      (conv): Conv2d(256, 128, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (bn): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (act_fn): Mish()
    )
    (conv_1_twist): ConvLayerTwist(
      (conv): NewTwist(
        twist: True, permute: True, same: True, groups: 16
        (conv): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), groups=16, bias=False)
      )
      (bn): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (act_fn): Mish()
    )
    (conv_2): ConvLayer(
      (conv): Conv2d(128, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (bn): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    )
  )
  (idconv): ConvLayer(
    (conv): Conv2d(256, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)
    (bn): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  )
  (merge): Mish()
)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="end">end<a class="anchor-link" href="#end"> </a></h1>
</div>
</div>
</div>
</div>
 

