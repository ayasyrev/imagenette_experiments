---

title: imagenette_experiments

keywords: fastai
sidebar: home_sidebar

summary: "experiments with fastai imagenette / imagewoof datasets"
description: "experiments with fastai imagenette / imagewoof datasets"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notebooks with experiments. Models trained with fastai v1 on Imagewoof dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This results was done with experimental model - XResnet with modification.<br>
I used pool layer plus convolution stride 1 instead of convolution stride 2.<br>
And instead of regular pytorch pool (AveragePool2d and MaxPool2d) i used MaxBlurPool as described here:<br>
<a href="https://forums.fast.ai/t/imagenette-imagewoof-leaderboards/45822/20?u=a_yasyrev">fastai forum topic</a><br>
<a href="https://github.com/ducha-aiki/Ranger-Mish-ImageWoof-5/blob/master/mxresnet.py#L121">github ducha-aiki</a></p>
<p>Activation function - Mish, long disscussion <a href="https://forums.fast.ai/t/meet-mish-new-activation-function-possible-successor-to-relu">on fastai forum</a><br>
Fit with Ranger optimizer and flat with annealing - <a href="https://forums.fast.ai/t/how-we-beat-the-5-epoch-imagewoof-leaderboard-score-some-new-techniques-to-consider">long tread on fastai forum</a></p>
<p>Model was created with <a href="https://github.com/ayasyrev/model_constructor">model-constructor</a><br>
Explanation how model was created here: <a href="https://github.com/ayasyrev/imagenette_experiments/blob/master/ResnetTrick_create_model_fit.ipynb">https://github.com/ayasyrev/imagenette_experiments/blob/master/ResnetTrick_create_model_fit.ipynb</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Current results vs results on leaderboard - ImageWOOF:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<table>
<thead><tr>
<th>Size (px)</th>
<th>Epochs</th>
<th></th>
<th>Accuracy</th>
<th># Runs</th>
<th>My res</th>
<th>URL</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>128</td>
<td>5</td>
<td></td>
<td>73.37%</td>
<td>5, mean</td>
<td></td>
</tr>
<tr>
<td>128</td>
<td>20</td>
<td></td>
<td>85.52%</td>
<td>5, mean</td>
<td>86.10%</td>
<td></td>
</tr>
<tr>
<td>128</td>
<td>80</td>
<td></td>
<td>87.20%</td>
<td>1</td>
<td>87.63%</td>
<td><a href="https://github.com/ayasyrev/imagenette_experiments/blob/master/Woof_MaxBlurPool_ResnetTrick_s128_e80_8763.ipynb">notebook</a></td>
<td>3 runs, start_pct=0.3</td>
</tr>
<tr>
<td>128</td>
<td>200</td>
<td></td>
<td>87.20%</td>
<td>1</td>
<td>88.30%</td>
<td><a href="https://github.com/ayasyrev/imagenette_experiments/blob/master/Woof_MaxBlurPool_ResnetTrick_s128_e200_8830.ipynb">notebook</a></td>
<td>3 runs, start_pct=0.2</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>192</td>
<td>5</td>
<td></td>
<td>75.94%</td>
<td>5, mean</td>
<td>77.87%</td>
<td><a href="https://github.com/ayasyrev/imagenette_experiments/blob/master/Woof_MaxBlurPool_ResnetTrick_s192bs32.ipynb">notebook</a></td>
<td>added to board</td>
</tr>
<tr>
<td>192</td>
<td>20</td>
<td></td>
<td>87.25%</td>
<td>5, mean</td>
<td>87.85%</td>
<td><a href="https://github.com/ayasyrev/imagenette_experiments/blob/master/Woof_MaxBlurPool_ResnetTrick_s192bs32.ipynb">notebook</a></td>
<td>added to board</td>
</tr>
<tr>
<td>192</td>
<td>80</td>
<td></td>
<td>89.21%</td>
<td>1</td>
<td>89.69%</td>
<td><a href="https://github.com/ayasyrev/imagenette_experiments/blob/master/Woof_MaxBlurPool_ResnetTrick_s192bs32_e80_8969.ipynb">notebook</a></td>
<td>4 runs.</td>
</tr>
<tr>
<td>192</td>
<td>200</td>
<td></td>
<td>89.54%</td>
<td>1</td>
<td>90.35%</td>
<td><a href="https://github.com/ayasyrev/imagenette_experiments/blob/master/Woof_MaxBlurPool_ResnetTrick_s192bs32_e200_9035.ipynb">notebook</a></td>
<td>2 runs.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>256</td>
<td>5</td>
<td></td>
<td>76.87%</td>
<td>5, mean</td>
<td>78,84%</td>
<td><a href="https://github.com/ayasyrev/imagenette_experiments/blob/master/Woof_MaxBlurPool_ResnetTrick_s256bs32.ipynb">notebook</a></td>
<td>added to board</td>
</tr>
<tr>
<td>256</td>
<td>20</td>
<td></td>
<td>88.29%</td>
<td>5, mean</td>
<td>88,58%</td>
<td><a href="https://github.com/ayasyrev/imagenette_experiments/blob/master/Woof_MaxBlurPool_ResnetTrick_s256bs32.ipynb">notebook</a></td>
<td>added to board</td>
</tr>
<tr>
<td>256</td>
<td>80</td>
<td></td>
<td>90.48%</td>
<td>1</td>
<td>90.63%</td>
<td><a href="https://github.com/ayasyrev/imagenette_experiments/blob/master/Woof_MaxBlurPool_ResnetTrick_s256bs16_e80_9063.ipynb">notebook</a></td>
<td>2 runs, start_pct=0.4</td>
</tr>
<tr>
<td>256</td>
<td>200</td>
<td></td>
<td>90.38%</td>
<td>1</td>
<td>91.14%</td>
<td><a href="https://github.com/ayasyrev/imagenette_experiments/blob/master/Woof_MaxBlurPool_ResnetTrick_s256bs16_e200_9114.ipynb">notebook</a></td>
<td>3 runs, start_pct=0.2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How to repeat results:<br>
All notebooks can be run on google colab.</p>
<p>Install this repo:
<code>pip install -e git+https://github.com/ayasyrev/imagenette_experiments</code><br>
Now import Model constructor and helper utils as:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">imagenette_experiments.train_utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">imagenette_experiments.trick_model</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now create model constructor:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can check model, for example:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">l_1</span><span class="o">.</span><span class="n">bl_0</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>NewResBlock(
  (reduce): MaxBlurPool2d()
  (convs): Sequential(
    (conv_0): ConvLayer(
      (conv): Conv2d(256, 128, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (bn): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (act_fn): Mish()
    )
    (conv_1): ConvLayer(
      (conv): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (bn): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (act_fn): Mish()
    )
    (conv_2): ConvLayer(
      (conv): Conv2d(128, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (bn): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    )
  )
  (idconv): ConvLayer(
    (conv): Conv2d(256, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)
    (bn): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  )
  (merge): Mish()
)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lets create Learner:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">get_learn</span><span class="p">(</span><span class="n">woof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>data path   /root/.fastai/data/imagewoof2
Learn path /root/.fastai/data/imagewoof2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we cat train it regular fastai way, for example fit with annealing:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>learn.fit_fc(tot_epochs=5, lr=1e-4, moms=(0.95,0.95), start_pct=0.72)</code></p>

</div>
</div>
</div>
</div>
 

